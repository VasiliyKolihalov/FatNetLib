# Заметки по дизайну

## Цель
Требуется написать транспортный фреймворк для видеоигр

## Требования
1. маршрутизация  
Вызов необходимого эндпоинт
2. сериализация  
Преобразование аргументов в массив байт и обратно для посылки
3. аутентификация
4. шифрование
5. легковесный пакет данных  
Поскольку будет использоваться в играх с большим серверным фпс
6. сжатие пакета данных
7. версионирование протокола

## Хотелки
1. удобный апи
2. легкое встраивание в проекты
3. опора на http с переосмыслением
4. модульность  
Добавление и вырезание фич - шифрование, аутентификация...  
Кастомизация через мидлвейры.  
Подмена транспортной библиотеки tcp/udp библиотек.  
5. режим запрос-ответ
6. обработка исключений в режиме запрос-ответ
7. кодогенерация клиентского и контроллерного класса
8. contract first
9. поддержка форматов сериализации со схемой
10. еще большее сжатие пакета данных через кодирование ключей, роутов, енумов, констант
11. апи в стиле классичетских контроллеров
12. апи в стиле билдеров
13. авторизация
14. версии для c#, java и других языков с интеропом

## Что не нравится в http
Хоть мы и предпочли опереться на http протокол, многое в нем нам либо не подходит, либо не нравится:
1. Глаголы  
Дефолтных ограниченое количество.
Технически можно ввести новые, но с кучей проблем.  
Сами глаголы спорные (post, put).  
Непонятно, каким глаголом выразить эндпоинт /report/calculate.  
2. Get без request body  
Для сложных get запросов с параметрами приходится изворачиваться через query и path params  
3. Неоправданная сложность  
Слишком много сущностей.  
Порой дублируются.  
Порой заставляют разработчика выбирать.  
Порой не нужны.  
Порой вовсе не решают современные проблемы.  
Заголовки, body, response code, query params, path params, cookies, verbs
4. Эмуляция папок  
Сама концепция папок сомнительна.  
/report/calculate рушит концепцию.  
Пусть есть фильм с его изображениями.  
Добавляем изображениями POST /movie/{movieId}/images.  
Но можем получить постер по GET /images/{id}.  
То есть не оттуда, куда положили.  
5. Path params и query params нужно энкодить  
Это приводит к ошибкам.  
6. Коды ответов  
1хх бесполезны.  
3хх сомнительны.  
Из 2xx можно оставить только 200.  
Многие ошибки неясны (409 conflict, 422).  
7. Cors и cookies кровь из глаз  
Слишком много ограничений.  
Возможно просто хреновая реализация от фреймворков.  
8. Хедеры плоские ключ-значение, нет иерархии  
Access-Control-Allow-Origin, Access-Control-Allow-Method, Access-Control-Allow-Headers
9. В хэдеры, query params, request params не положить бинари без энкодинга (вроде бы)  
10. Большой размер передаваемых данных, можно компактнее  
11. Response body и error body вперемешку    